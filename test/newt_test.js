const moment = require('moment-timezone');
const Newt = require('../src/newt');
const { expect } = require('chai');

describe.only('new iterator', () => {
  it('can be configured to run tests on only weekdays', () => {
    const i = new Newt({
      frequency: 0,
      interval: 1,
      byDay: [1, 2, 3, 4, 5],
      count: 7,
      dtstart: moment.tz('2017-01-01T00:30:13.000Z', 'Australia/Sydney'),
      tzid: 'Australia/Sydney',
    });

    for (const x of i) {
      expect([1, 2, 3, 4, 5].includes(x.day()));
      expect(x.hour()).to.equal(11);
      expect(x.minute()).to.equal(30);
      expect(x.second()).to.equal(13);
    }
  });

  it('daily', () => {
    const i = new Newt({
      frequency: 3,
      interval: 1,
      count: 10,
      dtstart: moment.tz('19970902T090000', 'America/New_York'),
      tzid: 'America/New_York',
    });

    expect(Array.from(i).map(x => x.toISOString()).join(',')).to.equal('1997-09-02T13:00:00.000Z,1997-09-03T13:00:00.000Z,1997-09-04T13:00:00.000Z,1997-09-05T13:00:00.000Z,1997-09-06T13:00:00.000Z,1997-09-07T13:00:00.000Z,1997-09-08T13:00:00.000Z,1997-09-09T13:00:00.000Z,1997-09-10T13:00:00.000Z,1997-09-11T13:00:00.000Z');
  });

  it('daily until the 9th of sept', () => {
    const i = new Newt({
      frequency: 3,
      interval: 1,
      until: moment.tz('19970909T090000', 'America/New_York'),
      dtstart: moment.tz('19970902T090000', 'America/New_York'),
      tzid: 'America/New_York',
    });

    expect(Array.from(i).map(x => x.toISOString()).join(',')).to.equal('1997-09-02T13:00:00.000Z,1997-09-03T13:00:00.000Z,1997-09-04T13:00:00.000Z,1997-09-05T13:00:00.000Z,1997-09-06T13:00:00.000Z,1997-09-07T13:00:00.000Z,1997-09-08T13:00:00.000Z,1997-09-09T13:00:00.000Z');
  });

  it('every 10 days, 5 times', () => {
    const i = new Newt({
      frequency: 3,
      interval: 10,
      count: 5,
      dtstart: moment.tz('19970902T090000', 'America/New_York'),
      tzid: 'America/New_York',
    });

    expect(Array.from(i).map(x => x.toISOString()).join(',')).to.equal('1997-09-02T13:00:00.000Z,1997-09-12T13:00:00.000Z,1997-09-22T13:00:00.000Z,1997-10-02T13:00:00.000Z,1997-10-12T13:00:00.000Z');
  });

  it('every other day', () => {
    const i = new Newt({
      frequency: 3,
      interval: 2,
      byHour: [9],
      byMinute: [0],
      count: 10,
      dtstart: moment.tz('19970902T090000', 'America/New_York'),
      tzid: 'America/New_York',
    });

    expect(Array.from(i).map(x => x.toISOString()).join(',')).to.equal('1997-09-02T13:00:00.000Z,1997-09-04T13:00:00.000Z,1997-09-06T13:00:00.000Z,1997-09-08T13:00:00.000Z,1997-09-10T13:00:00.000Z,1997-09-12T13:00:00.000Z,1997-09-14T13:00:00.000Z,1997-09-16T13:00:00.000Z,1997-09-18T13:00:00.000Z,1997-09-20T13:00:00.000Z');
  });

  it('every day in jan for 3 years, by year', () => {
    const i = new Newt({
      frequency: 5,
      interval: 1,
      byMonth: [0],
      byDay: [0, 1, 2, 3, 4, 5, 6],
      until: moment.tz('20000131T140000Z', 'America/New_York'),
      dtstart: moment.tz('19980101T090000', 'America/New_York'),
      tzid: 'America/New_York',
    });

    expect(Array.from(i).map(x => x.toISOString()).join(',')).to.equal('1998-01-01T14:00:00.000Z,1998-01-02T14:00:00.000Z,1998-01-03T14:00:00.000Z,1998-01-04T14:00:00.000Z,1998-01-05T14:00:00.000Z,1998-01-06T14:00:00.000Z,1998-01-07T14:00:00.000Z,1998-01-08T14:00:00.000Z,1998-01-09T14:00:00.000Z,1998-01-10T14:00:00.000Z,1998-01-11T14:00:00.000Z,1998-01-12T14:00:00.000Z,1998-01-13T14:00:00.000Z,1998-01-14T14:00:00.000Z,1998-01-15T14:00:00.000Z,1998-01-16T14:00:00.000Z,1998-01-17T14:00:00.000Z,1998-01-18T14:00:00.000Z,1998-01-19T14:00:00.000Z,1998-01-20T14:00:00.000Z,1998-01-21T14:00:00.000Z,1998-01-22T14:00:00.000Z,1998-01-23T14:00:00.000Z,1998-01-24T14:00:00.000Z,1998-01-25T14:00:00.000Z,1998-01-26T14:00:00.000Z,1998-01-27T14:00:00.000Z,1998-01-28T14:00:00.000Z,1998-01-29T14:00:00.000Z,1998-01-30T14:00:00.000Z,1998-01-31T14:00:00.000Z,1999-01-01T14:00:00.000Z,1999-01-02T14:00:00.000Z,1999-01-03T14:00:00.000Z,1999-01-04T14:00:00.000Z,1999-01-05T14:00:00.000Z,1999-01-06T14:00:00.000Z,1999-01-07T14:00:00.000Z,1999-01-08T14:00:00.000Z,1999-01-09T14:00:00.000Z,1999-01-10T14:00:00.000Z,1999-01-11T14:00:00.000Z,1999-01-12T14:00:00.000Z,1999-01-13T14:00:00.000Z,1999-01-14T14:00:00.000Z,1999-01-15T14:00:00.000Z,1999-01-16T14:00:00.000Z,1999-01-17T14:00:00.000Z,1999-01-18T14:00:00.000Z,1999-01-19T14:00:00.000Z,1999-01-20T14:00:00.000Z,1999-01-21T14:00:00.000Z,1999-01-22T14:00:00.000Z,1999-01-23T14:00:00.000Z,1999-01-24T14:00:00.000Z,1999-01-25T14:00:00.000Z,1999-01-26T14:00:00.000Z,1999-01-27T14:00:00.000Z,1999-01-28T14:00:00.000Z,1999-01-29T14:00:00.000Z,1999-01-30T14:00:00.000Z,1999-01-31T14:00:00.000Z,2000-01-01T14:00:00.000Z,2000-01-02T14:00:00.000Z,2000-01-03T14:00:00.000Z,2000-01-04T14:00:00.000Z,2000-01-05T14:00:00.000Z,2000-01-06T14:00:00.000Z,2000-01-07T14:00:00.000Z,2000-01-08T14:00:00.000Z,2000-01-09T14:00:00.000Z,2000-01-10T14:00:00.000Z,2000-01-11T14:00:00.000Z,2000-01-12T14:00:00.000Z,2000-01-13T14:00:00.000Z,2000-01-14T14:00:00.000Z,2000-01-15T14:00:00.000Z,2000-01-16T14:00:00.000Z,2000-01-17T14:00:00.000Z,2000-01-18T14:00:00.000Z,2000-01-19T14:00:00.000Z,2000-01-20T14:00:00.000Z,2000-01-21T14:00:00.000Z,2000-01-22T14:00:00.000Z,2000-01-23T14:00:00.000Z,2000-01-24T14:00:00.000Z,2000-01-25T14:00:00.000Z,2000-01-26T14:00:00.000Z,2000-01-27T14:00:00.000Z,2000-01-28T14:00:00.000Z,2000-01-29T14:00:00.000Z,2000-01-30T14:00:00.000Z,2000-01-31T14:00:00.000Z');
  });

  it('every day in jan for 3 years, by day', () => {
    const i = new Newt({
      frequency: 3,
      interval: 1,
      byMonth: [0],
      until: moment.tz('20000131T140000Z', 'America/New_York'),
      dtstart: moment.tz('19980101T090000', 'America/New_York'),
      tzid: 'America/New_York',
    });

    expect(Array.from(i).map(x => x.toISOString()).join(',')).to.equal('1998-01-01T14:00:00.000Z,1998-01-02T14:00:00.000Z,1998-01-03T14:00:00.000Z,1998-01-04T14:00:00.000Z,1998-01-05T14:00:00.000Z,1998-01-06T14:00:00.000Z,1998-01-07T14:00:00.000Z,1998-01-08T14:00:00.000Z,1998-01-09T14:00:00.000Z,1998-01-10T14:00:00.000Z,1998-01-11T14:00:00.000Z,1998-01-12T14:00:00.000Z,1998-01-13T14:00:00.000Z,1998-01-14T14:00:00.000Z,1998-01-15T14:00:00.000Z,1998-01-16T14:00:00.000Z,1998-01-17T14:00:00.000Z,1998-01-18T14:00:00.000Z,1998-01-19T14:00:00.000Z,1998-01-20T14:00:00.000Z,1998-01-21T14:00:00.000Z,1998-01-22T14:00:00.000Z,1998-01-23T14:00:00.000Z,1998-01-24T14:00:00.000Z,1998-01-25T14:00:00.000Z,1998-01-26T14:00:00.000Z,1998-01-27T14:00:00.000Z,1998-01-28T14:00:00.000Z,1998-01-29T14:00:00.000Z,1998-01-30T14:00:00.000Z,1998-01-31T14:00:00.000Z,1999-01-01T14:00:00.000Z,1999-01-02T14:00:00.000Z,1999-01-03T14:00:00.000Z,1999-01-04T14:00:00.000Z,1999-01-05T14:00:00.000Z,1999-01-06T14:00:00.000Z,1999-01-07T14:00:00.000Z,1999-01-08T14:00:00.000Z,1999-01-09T14:00:00.000Z,1999-01-10T14:00:00.000Z,1999-01-11T14:00:00.000Z,1999-01-12T14:00:00.000Z,1999-01-13T14:00:00.000Z,1999-01-14T14:00:00.000Z,1999-01-15T14:00:00.000Z,1999-01-16T14:00:00.000Z,1999-01-17T14:00:00.000Z,1999-01-18T14:00:00.000Z,1999-01-19T14:00:00.000Z,1999-01-20T14:00:00.000Z,1999-01-21T14:00:00.000Z,1999-01-22T14:00:00.000Z,1999-01-23T14:00:00.000Z,1999-01-24T14:00:00.000Z,1999-01-25T14:00:00.000Z,1999-01-26T14:00:00.000Z,1999-01-27T14:00:00.000Z,1999-01-28T14:00:00.000Z,1999-01-29T14:00:00.000Z,1999-01-30T14:00:00.000Z,1999-01-31T14:00:00.000Z,2000-01-01T14:00:00.000Z,2000-01-02T14:00:00.000Z,2000-01-03T14:00:00.000Z,2000-01-04T14:00:00.000Z,2000-01-05T14:00:00.000Z,2000-01-06T14:00:00.000Z,2000-01-07T14:00:00.000Z,2000-01-08T14:00:00.000Z,2000-01-09T14:00:00.000Z,2000-01-10T14:00:00.000Z,2000-01-11T14:00:00.000Z,2000-01-12T14:00:00.000Z,2000-01-13T14:00:00.000Z,2000-01-14T14:00:00.000Z,2000-01-15T14:00:00.000Z,2000-01-16T14:00:00.000Z,2000-01-17T14:00:00.000Z,2000-01-18T14:00:00.000Z,2000-01-19T14:00:00.000Z,2000-01-20T14:00:00.000Z,2000-01-21T14:00:00.000Z,2000-01-22T14:00:00.000Z,2000-01-23T14:00:00.000Z,2000-01-24T14:00:00.000Z,2000-01-25T14:00:00.000Z,2000-01-26T14:00:00.000Z,2000-01-27T14:00:00.000Z,2000-01-28T14:00:00.000Z,2000-01-29T14:00:00.000Z,2000-01-30T14:00:00.000Z,2000-01-31T14:00:00.000Z');
  });
});
